<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Connexion ‚Äì RCVO</title>
  <style>
    body { font-family:sans-serif; margin:0; padding:2rem; }
    nav { background:#007BFF; padding:1rem; }
    nav a { color:#fff; margin-right:1rem; text-decoration:none; }
    form { max-width:300px; margin:2rem auto; }
    label, input { display:block; width:100%; margin-bottom:.5rem; }
    .password-wrapper { position:relative; }
    .toggle-btn {
      position:absolute; top:50%; right:.5rem;
      transform:translateY(-50%);
      background:none; border:none; cursor:pointer;
    }
    button[type=submit] { padding:.5rem 1rem; background:#007BFF; color:#fff; border:none; }
    #error { color:red; margin-top:1rem; }
  </style>
</head>
<body>

  <nav>
    <a href="index.html">Accueil</a>
    <a href="login_v2.html">Connexion</a>
    <a href="register_v2.html">Inscription</a>
  </nav>

  <h1>Connexion</h1>
  <form id="loginForm">
    <label for="email">Email :</label>
    <input id="email" type="email" required />

    <label for="password">Mot de passe :</label>
    <div class="password-wrapper">
      <input id="password" type="password" required />
      <button type="button" class="toggle-btn" id="togglePassword">üëÅÔ∏è</button>
    </div>

    <button type="submit">Se connecter</button>
  </form>
  <div id="error"></div>

  <script>
    // Toggle visibilit√©
    document.getElementById('togglePassword').addEventListener('click', () => {
      const pwd = document.getElementById('password');
      pwd.type = pwd.type === 'password' ? 'text' : 'password';
    });

    document.getElementById('loginForm').addEventListener('submit', async e => {
      e.preventDefault();
      const errorDiv = document.getElementById('error');
      errorDiv.textContent = '';
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      console.log('Envoi du login:', email, password);
      try {
        const res = await fetch(
          'https://Rcvo-Backend-env.eba-k3tjwhr3.eu-west-3.elasticbeanstalk.com/api/admin/login',
          {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email, password })
          }
        );
        console.log('R√©ponse status:', res.status);
        if (!res.ok) {
          const txt = await res.text();
          console.error('Login √©chou√©:', txt);
          throw new Error(txt || res.statusText);
        }
        const json = await res.json();
        console.log('Login OK, token re√ßu:', json.token);
        alert('Connexion r√©ussie, redirection‚Ä¶');
        window.location.href = 'index.html';
      } catch (err) {
        console.error(err);
        errorDiv.textContent = err.message || 'Erreur de connexion';
      }
    });
  </script>

</body>
</html>
